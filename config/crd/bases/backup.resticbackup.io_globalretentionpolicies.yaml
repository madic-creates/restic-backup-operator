---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: globalretentionpolicies.backup.resticbackup.io
spec:
  group: backup.resticbackup.io
  names:
    kind: GlobalRetentionPolicy
    listKind: GlobalRetentionPolicyList
    plural: globalretentionpolicies
    shortNames:
    - grp
    singular: globalretentionpolicy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.schedule
      name: Schedule
      type: string
    - jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    - jsonPath: .status.lastRun
      name: Last Run
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: GlobalRetentionPolicy is the Schema for the globalretentionpolicies
          API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: GlobalRetentionPolicySpec defines the desired state of GlobalRetentionPolicy.
            properties:
              jobConfig:
                description: JobConfig configures the retention job.
                properties:
                  activeDeadlineSeconds:
                    default: 3600
                    description: ActiveDeadlineSeconds specifies the job timeout.
                    format: int64
                    minimum: 1
                    type: integer
                  affinity:
                    description: Affinity defines pod affinity rules.
                    x-kubernetes-preserve-unknown-fields: true
                  backoffLimit:
                    default: 0
                    description: BackoffLimit specifies the number of retries before
                      considering a job as failed.
                    format: int32
                    minimum: 0
                    type: integer
                  concurrencyPolicy:
                    default: Forbid
                    description: ConcurrencyPolicy specifies how to treat concurrent
                      executions.
                    enum:
                    - Allow
                    - Forbid
                    - Replace
                    type: string
                  failedJobsHistoryLimit:
                    default: 3
                    description: FailedJobsHistoryLimit specifies how many failed
                      jobs to keep.
                    format: int32
                    minimum: 0
                    type: integer
                  nodeSelector:
                    additionalProperties:
                      type: string
                    description: NodeSelector defines node selection constraints.
                    type: object
                  resources:
                    description: Resources defines resource requirements for the backup
                      container.
                    x-kubernetes-preserve-unknown-fields: true
                  securityContext:
                    description: SecurityContext defines the security context for
                      the backup pod.
                    x-kubernetes-preserve-unknown-fields: true
                  serviceAccountName:
                    description: ServiceAccountName specifies the service account
                      for the backup pod.
                    type: string
                  successfulJobsHistoryLimit:
                    default: 3
                    description: SuccessfulJobsHistoryLimit specifies how many successful
                      jobs to keep.
                    format: int32
                    minimum: 0
                    type: integer
                  tolerations:
                    description: Tolerations defines pod tolerations.
                    x-kubernetes-preserve-unknown-fields: true
                type: object
              notifications:
                description: Notifications configures retention notifications.
                properties:
                  email:
                    description: Email configures email notifications.
                    properties:
                      enabled:
                        description: Enabled enables email notifications.
                        type: boolean
                      from:
                        description: From is the sender email address.
                        type: string
                      smtpServer:
                        description: SMTPServer is the SMTP server address.
                        type: string
                      subject:
                        description: Subject is the email subject.
                        type: string
                      to:
                        description: To is the recipient email address.
                        type: string
                    type: object
                  ntfy:
                    description: Ntfy configures ntfy notifications.
                    properties:
                      credentialsSecretRef:
                        description: |-
                          CredentialsSecretRef references a secret containing ntfy credentials.
                          The secret should contain a key 'auth-header' with the Authorization header value.
                        properties:
                          key:
                            description: Key within the secret to select.
                            type: string
                          name:
                            description: Name of the secret in the same namespace.
                            type: string
                        required:
                        - name
                        type: object
                      enabled:
                        description: Enabled enables ntfy notifications.
                        type: boolean
                      onlyOnFailure:
                        description: OnlyOnFailure sends notifications only on failure.
                        type: boolean
                      priority:
                        default: 4
                        description: Priority is the notification priority (1-5).
                        format: int32
                        maximum: 5
                        minimum: 1
                        type: integer
                      serverURL:
                        description: ServerURL is the ntfy server URL.
                        pattern: ^https?://.*
                        type: string
                      tags:
                        description: Tags are ntfy notification tags.
                        items:
                          type: string
                        type: array
                      topic:
                        description: Topic is the ntfy topic.
                        type: string
                    required:
                    - serverURL
                    - topic
                    type: object
                type: object
              policies:
                description: Policies defines retention policies per tag/hostname.
                items:
                  description: RetentionPolicyEntry defines a retention policy for
                    a set of snapshots.
                  properties:
                    retention:
                      description: Retention defines the retention rules.
                      properties:
                        keepDaily:
                          description: KeepDaily specifies the number of daily snapshots
                            to keep.
                          format: int32
                          minimum: 0
                          type: integer
                        keepHourly:
                          description: KeepHourly specifies the number of hourly snapshots
                            to keep.
                          format: int32
                          minimum: 0
                          type: integer
                        keepLast:
                          description: KeepLast specifies the number of last snapshots
                            to keep.
                          format: int32
                          minimum: 0
                          type: integer
                        keepMonthly:
                          description: KeepMonthly specifies the number of monthly
                            snapshots to keep.
                          format: int32
                          minimum: 0
                          type: integer
                        keepWeekly:
                          description: KeepWeekly specifies the number of weekly snapshots
                            to keep.
                          format: int32
                          minimum: 0
                          type: integer
                        keepYearly:
                          description: KeepYearly specifies the number of yearly snapshots
                            to keep.
                          format: int32
                          minimum: 0
                          type: integer
                      type: object
                    selector:
                      description: Selector selects snapshots for this policy.
                      properties:
                        hostname:
                          description: Hostname filters snapshots by hostname.
                          type: string
                        tags:
                          description: Tags filters snapshots by tags.
                          items:
                            type: string
                          type: array
                      type: object
                  required:
                  - retention
                  - selector
                  type: object
                minItems: 1
                type: array
              prune:
                description: Prune runs prune after all forget operations.
                type: boolean
              repositoryRef:
                description: RepositoryRef references the ResticRepository.
                properties:
                  name:
                    description: Name of the resource.
                    type: string
                  namespace:
                    description: Namespace of the resource. If empty, uses the same
                      namespace as the referencing resource.
                    type: string
                required:
                - name
                type: object
              schedule:
                description: Schedule is the cron schedule for retention runs.
                type: string
              suspend:
                default: false
                description: Suspend suspends retention scheduling.
                type: boolean
            required:
            - policies
            - repositoryRef
            - schedule
            type: object
          status:
            description: GlobalRetentionPolicyStatus defines the observed state of
              GlobalRetentionPolicy.
            properties:
              conditions:
                description: Conditions represent the latest available observations.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              cronJobRef:
                description: CronJobRef references the managed CronJob.
                properties:
                  name:
                    description: Name of the resource.
                    type: string
                  namespace:
                    description: Namespace of the resource.
                    type: string
                required:
                - name
                - namespace
                type: object
              lastRun:
                description: LastRun is the timestamp of the last retention run.
                format: date-time
                type: string
              lastRunDuration:
                description: LastRunDuration is the duration of the last retention
                  run.
                type: string
              lastRunResult:
                description: LastRunResult is the result of the last retention run.
                type: string
              nextRun:
                description: NextRun is the timestamp of the next scheduled run.
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation of the spec
                  observed by the controller.
                format: int64
                type: integer
              repositorySizeAfter:
                description: RepositorySizeAfter is the repository size after the
                  last run.
                type: string
              repositorySizeBefore:
                description: RepositorySizeBefore is the repository size before the
                  last run.
                type: string
              snapshotsRemoved:
                description: SnapshotsRemoved is the number of snapshots removed in
                  the last run.
                format: int32
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
