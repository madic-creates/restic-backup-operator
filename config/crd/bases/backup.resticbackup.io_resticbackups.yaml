---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: resticbackups.backup.resticbackup.io
spec:
  group: backup.resticbackup.io
  names:
    kind: ResticBackup
    listKind: ResticBackupList
    plural: resticbackups
    shortNames:
    - rb
    singular: resticbackup
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.schedule
      name: Schedule
      type: string
    - jsonPath: .status.conditions[?(@.type=='Ready')].status
      name: Ready
      type: string
    - jsonPath: .status.lastSuccessfulBackup
      name: Last Backup
      type: date
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ResticBackup is the Schema for the resticbackups API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ResticBackupSpec defines the desired state of ResticBackup.
            properties:
              hooks:
                description: Hooks defines pre/post backup hooks.
                properties:
                  onFailure:
                    description: OnFailure runs when a backup fails.
                    properties:
                      exec:
                        description: Exec defines an exec hook to run in an existing
                          pod.
                        properties:
                          command:
                            description: Command is the command to execute.
                            items:
                              type: string
                            minItems: 1
                            type: array
                          container:
                            description: Container is the container name to execute
                              the command in.
                            type: string
                          podSelector:
                            description: PodSelector selects the pod to execute the
                              command in.
                            properties:
                              matchExpressions:
                                description: matchExpressions is a list of label selector
                                  requirements. The requirements are ANDed.
                                items:
                                  description: |-
                                    A label selector requirement is a selector that contains values, a key, and an operator that
                                    relates the key and values.
                                  properties:
                                    key:
                                      description: key is the label key that the selector
                                        applies to.
                                      type: string
                                    operator:
                                      description: |-
                                        operator represents a key's relationship to a set of values.
                                        Valid operators are In, NotIn, Exists and DoesNotExist.
                                      type: string
                                    values:
                                      description: |-
                                        values is an array of string values. If the operator is In or NotIn,
                                        the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                        the values array must be empty. This array is replaced during a strategic
                                        merge patch.
                                      items:
                                        type: string
                                      type: array
                                      x-kubernetes-list-type: atomic
                                  required:
                                  - key
                                  - operator
                                  type: object
                                type: array
                                x-kubernetes-list-type: atomic
                              matchLabels:
                                additionalProperties:
                                  type: string
                                description: |-
                                  matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                                  map is equivalent to an element of matchExpressions, whose key field is "key", the
                                  operator is "In", and the values array contains only "value". The requirements are ANDed.
                                type: object
                            type: object
                            x-kubernetes-map-type: atomic
                          timeout:
                            default: 60s
                            description: Timeout is the maximum duration for the hook
                              to run.
                            type: string
                        required:
                        - command
                        - podSelector
                        type: object
                      job:
                        description: Job defines a job-based hook.
                        properties:
                          podTemplate:
                            description: PodTemplate defines the pod specification
                              for the hook job.
                            x-kubernetes-preserve-unknown-fields: true
                        required:
                        - podTemplate
                        type: object
                    type: object
                  postBackup:
                    description: PostBackup runs after a successful backup.
                    properties:
                      exec:
                        description: Exec defines an exec hook to run in an existing
                          pod.
                        properties:
                          command:
                            description: Command is the command to execute.
                            items:
                              type: string
                            minItems: 1
                            type: array
                          container:
                            description: Container is the container name to execute
                              the command in.
                            type: string
                          podSelector:
                            description: PodSelector selects the pod to execute the
                              command in.
                            properties:
                              matchExpressions:
                                description: matchExpressions is a list of label selector
                                  requirements. The requirements are ANDed.
                                items:
                                  description: |-
                                    A label selector requirement is a selector that contains values, a key, and an operator that
                                    relates the key and values.
                                  properties:
                                    key:
                                      description: key is the label key that the selector
                                        applies to.
                                      type: string
                                    operator:
                                      description: |-
                                        operator represents a key's relationship to a set of values.
                                        Valid operators are In, NotIn, Exists and DoesNotExist.
                                      type: string
                                    values:
                                      description: |-
                                        values is an array of string values. If the operator is In or NotIn,
                                        the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                        the values array must be empty. This array is replaced during a strategic
                                        merge patch.
                                      items:
                                        type: string
                                      type: array
                                      x-kubernetes-list-type: atomic
                                  required:
                                  - key
                                  - operator
                                  type: object
                                type: array
                                x-kubernetes-list-type: atomic
                              matchLabels:
                                additionalProperties:
                                  type: string
                                description: |-
                                  matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                                  map is equivalent to an element of matchExpressions, whose key field is "key", the
                                  operator is "In", and the values array contains only "value". The requirements are ANDed.
                                type: object
                            type: object
                            x-kubernetes-map-type: atomic
                          timeout:
                            default: 60s
                            description: Timeout is the maximum duration for the hook
                              to run.
                            type: string
                        required:
                        - command
                        - podSelector
                        type: object
                      job:
                        description: Job defines a job-based hook.
                        properties:
                          podTemplate:
                            description: PodTemplate defines the pod specification
                              for the hook job.
                            x-kubernetes-preserve-unknown-fields: true
                        required:
                        - podTemplate
                        type: object
                    type: object
                  preBackup:
                    description: PreBackup runs before the backup starts.
                    properties:
                      exec:
                        description: Exec defines an exec hook to run in an existing
                          pod.
                        properties:
                          command:
                            description: Command is the command to execute.
                            items:
                              type: string
                            minItems: 1
                            type: array
                          container:
                            description: Container is the container name to execute
                              the command in.
                            type: string
                          podSelector:
                            description: PodSelector selects the pod to execute the
                              command in.
                            properties:
                              matchExpressions:
                                description: matchExpressions is a list of label selector
                                  requirements. The requirements are ANDed.
                                items:
                                  description: |-
                                    A label selector requirement is a selector that contains values, a key, and an operator that
                                    relates the key and values.
                                  properties:
                                    key:
                                      description: key is the label key that the selector
                                        applies to.
                                      type: string
                                    operator:
                                      description: |-
                                        operator represents a key's relationship to a set of values.
                                        Valid operators are In, NotIn, Exists and DoesNotExist.
                                      type: string
                                    values:
                                      description: |-
                                        values is an array of string values. If the operator is In or NotIn,
                                        the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                        the values array must be empty. This array is replaced during a strategic
                                        merge patch.
                                      items:
                                        type: string
                                      type: array
                                      x-kubernetes-list-type: atomic
                                  required:
                                  - key
                                  - operator
                                  type: object
                                type: array
                                x-kubernetes-list-type: atomic
                              matchLabels:
                                additionalProperties:
                                  type: string
                                description: |-
                                  matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                                  map is equivalent to an element of matchExpressions, whose key field is "key", the
                                  operator is "In", and the values array contains only "value". The requirements are ANDed.
                                type: object
                            type: object
                            x-kubernetes-map-type: atomic
                          timeout:
                            default: 60s
                            description: Timeout is the maximum duration for the hook
                              to run.
                            type: string
                        required:
                        - command
                        - podSelector
                        type: object
                      job:
                        description: Job defines a job-based hook.
                        properties:
                          podTemplate:
                            description: PodTemplate defines the pod specification
                              for the hook job.
                            x-kubernetes-preserve-unknown-fields: true
                        required:
                        - podTemplate
                        type: object
                    type: object
                type: object
              jobConfig:
                description: JobConfig configures the backup job/cronjob.
                properties:
                  activeDeadlineSeconds:
                    default: 3600
                    description: ActiveDeadlineSeconds specifies the job timeout.
                    format: int64
                    minimum: 1
                    type: integer
                  affinity:
                    description: Affinity defines pod affinity rules.
                    x-kubernetes-preserve-unknown-fields: true
                  backoffLimit:
                    default: 0
                    description: BackoffLimit specifies the number of retries before
                      considering a job as failed.
                    format: int32
                    minimum: 0
                    type: integer
                  concurrencyPolicy:
                    default: Forbid
                    description: ConcurrencyPolicy specifies how to treat concurrent
                      executions.
                    enum:
                    - Allow
                    - Forbid
                    - Replace
                    type: string
                  failedJobsHistoryLimit:
                    default: 3
                    description: FailedJobsHistoryLimit specifies how many failed
                      jobs to keep.
                    format: int32
                    minimum: 0
                    type: integer
                  nodeSelector:
                    additionalProperties:
                      type: string
                    description: NodeSelector defines node selection constraints.
                    type: object
                  resources:
                    description: Resources defines resource requirements for the backup
                      container.
                    x-kubernetes-preserve-unknown-fields: true
                  securityContext:
                    description: SecurityContext defines the security context for
                      the backup pod.
                    x-kubernetes-preserve-unknown-fields: true
                  serviceAccountName:
                    description: ServiceAccountName specifies the service account
                      for the backup pod.
                    type: string
                  successfulJobsHistoryLimit:
                    default: 3
                    description: SuccessfulJobsHistoryLimit specifies how many successful
                      jobs to keep.
                    format: int32
                    minimum: 0
                    type: integer
                  tolerations:
                    description: Tolerations defines pod tolerations.
                    x-kubernetes-preserve-unknown-fields: true
                type: object
              notifications:
                description: Notifications configures backup notifications.
                properties:
                  ntfy:
                    description: Ntfy configures ntfy push notifications.
                    properties:
                      credentialsSecretRef:
                        description: |-
                          CredentialsSecretRef references a secret containing ntfy credentials.
                          The secret can contain the following keys:
                            - "token": Bearer token for authentication (preferred over username/password)
                            - "username": Username for basic authentication
                            - "password": Password for basic authentication
                          If "token" is present, it will be used as Bearer token.
                          Otherwise, "username" and "password" will be used for Basic authentication.
                        properties:
                          name:
                            description: Name of the secret.
                            type: string
                          namespace:
                            description: Namespace of the secret. If empty, uses the
                              same namespace as the referencing resource.
                            type: string
                        required:
                        - name
                        type: object
                      enabled:
                        description: Enabled enables ntfy notifications.
                        type: boolean
                      onlyOnFailure:
                        description: OnlyOnFailure sends notifications only on failure.
                        type: boolean
                      priority:
                        default: 4
                        description: Priority is the notification priority (1-5).
                        format: int32
                        maximum: 5
                        minimum: 1
                        type: integer
                      serverURL:
                        description: ServerURL is the ntfy server URL.
                        pattern: ^https?://.*
                        type: string
                      tags:
                        description: Tags are ntfy notification tags.
                        items:
                          type: string
                        type: array
                      topic:
                        description: Topic is the ntfy topic.
                        type: string
                    required:
                    - serverURL
                    - topic
                    type: object
                  pushgateway:
                    description: Pushgateway configures Prometheus Pushgateway notifications.
                    properties:
                      enabled:
                        description: Enabled enables Pushgateway notifications.
                        type: boolean
                      jobName:
                        description: JobName is the job name in Pushgateway. Defaults
                          to "backup".
                        type: string
                      url:
                        description: URL of the Pushgateway.
                        pattern: ^https?://.*
                        type: string
                    required:
                    - url
                    type: object
                type: object
              repositoryRef:
                description: RepositoryRef references the ResticRepository to use.
                properties:
                  name:
                    description: Name of the resource.
                    type: string
                  namespace:
                    description: Namespace of the resource. If empty, uses the same
                      namespace as the referencing resource.
                    type: string
                required:
                - name
                type: object
              restic:
                description: Restic contains restic-specific configuration.
                properties:
                  extraArgs:
                    description: ExtraArgs are additional restic backup arguments.
                    items:
                      type: string
                    type: array
                  hostname:
                    description: Hostname is the hostname for snapshots. Defaults
                      to the CR name.
                    type: string
                  image:
                    default: ghcr.io/restic/restic:0.18.0
                    description: Image is the container image for restic.
                    type: string
                  tags:
                    description: Tags are tags for this backup.
                    items:
                      type: string
                    type: array
                type: object
              retention:
                description: Retention configures snapshot retention.
                properties:
                  enabled:
                    description: Enabled enables retention after each backup.
                    type: boolean
                  groupBy:
                    description: GroupBy specifies the grouping for retention. Defaults
                      to "host,tags".
                    items:
                      type: string
                    type: array
                  policy:
                    description: Policy defines the retention policy.
                    properties:
                      keepDaily:
                        description: KeepDaily specifies the number of daily snapshots
                          to keep.
                        format: int32
                        minimum: 0
                        type: integer
                      keepHourly:
                        description: KeepHourly specifies the number of hourly snapshots
                          to keep.
                        format: int32
                        minimum: 0
                        type: integer
                      keepLast:
                        description: KeepLast specifies the number of last snapshots
                          to keep.
                        format: int32
                        minimum: 0
                        type: integer
                      keepMonthly:
                        description: KeepMonthly specifies the number of monthly snapshots
                          to keep.
                        format: int32
                        minimum: 0
                        type: integer
                      keepWeekly:
                        description: KeepWeekly specifies the number of weekly snapshots
                          to keep.
                        format: int32
                        minimum: 0
                        type: integer
                      keepYearly:
                        description: KeepYearly specifies the number of yearly snapshots
                          to keep.
                        format: int32
                        minimum: 0
                        type: integer
                    type: object
                  prune:
                    description: Prune runs prune after forget (can be expensive).
                    type: boolean
                type: object
              schedule:
                description: Schedule is the backup schedule in cron format.
                type: string
              source:
                description: Source defines what to backup.
                properties:
                  customSource:
                    description: CustomSource defines a custom backup source.
                    properties:
                      backupPath:
                        description: BackupPath is the path in the pod where backup
                          data is written.
                        type: string
                      podTemplate:
                        description: PodTemplate defines the pod specification for
                          the custom backup.
                        x-kubernetes-preserve-unknown-fields: true
                    required:
                    - backupPath
                    - podTemplate
                    type: object
                  podVolumeBackup:
                    description: PodVolumeBackup defines backing up a volume from
                      a running pod.
                    properties:
                      container:
                        description: Container is the container name to use. If empty,
                          uses the first container.
                        type: string
                      selector:
                        description: Selector selects the pod to backup from.
                        properties:
                          matchExpressions:
                            description: matchExpressions is a list of label selector
                              requirements. The requirements are ANDed.
                            items:
                              description: |-
                                A label selector requirement is a selector that contains values, a key, and an operator that
                                relates the key and values.
                              properties:
                                key:
                                  description: key is the label key that the selector
                                    applies to.
                                  type: string
                                operator:
                                  description: |-
                                    operator represents a key's relationship to a set of values.
                                    Valid operators are In, NotIn, Exists and DoesNotExist.
                                  type: string
                                values:
                                  description: |-
                                    values is an array of string values. If the operator is In or NotIn,
                                    the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                    the values array must be empty. This array is replaced during a strategic
                                    merge patch.
                                  items:
                                    type: string
                                  type: array
                                  x-kubernetes-list-type: atomic
                              required:
                              - key
                              - operator
                              type: object
                            type: array
                            x-kubernetes-list-type: atomic
                          matchLabels:
                            additionalProperties:
                              type: string
                            description: |-
                              matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                              map is equivalent to an element of matchExpressions, whose key field is "key", the
                              operator is "In", and the values array contains only "value". The requirements are ANDed.
                            type: object
                        type: object
                        x-kubernetes-map-type: atomic
                      volumeName:
                        description: VolumeName is the name of the volume in the pod
                          to backup.
                        type: string
                    required:
                    - selector
                    - volumeName
                    type: object
                  pvc:
                    description: PVC defines a PersistentVolumeClaim as the backup
                      source.
                    properties:
                      claimName:
                        description: ClaimName is the name of the PVC to backup.
                        type: string
                      excludes:
                        description: Excludes are paths to exclude from the backup.
                        items:
                          type: string
                        type: array
                      paths:
                        description: Paths are the paths within the PVC to backup.
                          Defaults to "/".
                        items:
                          type: string
                        type: array
                    required:
                    - claimName
                    type: object
                type: object
              suspend:
                default: false
                description: Suspend suspends backup scheduling.
                type: boolean
              timezone:
                default: UTC
                description: Timezone is the timezone for schedule interpretation.
                type: string
            required:
            - repositoryRef
            - schedule
            - source
            type: object
          status:
            description: ResticBackupStatus defines the observed state of ResticBackup.
            properties:
              conditions:
                description: Conditions represent the latest available observations.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              cronJobRef:
                description: CronJobRef references the managed CronJob.
                properties:
                  name:
                    description: Name of the resource.
                    type: string
                  namespace:
                    description: Namespace of the resource.
                    type: string
                required:
                - name
                - namespace
                type: object
              lastBackup:
                description: LastBackup contains information about the last backup.
                properties:
                  completionTime:
                    description: CompletionTime is when the backup completed.
                    format: date-time
                    type: string
                  duration:
                    description: Duration is the backup duration.
                    type: string
                  result:
                    description: 'Result is the backup result: Succeeded, Failed,
                      PartiallyFailed.'
                    type: string
                  snapshotID:
                    description: SnapshotID is the ID of the created snapshot.
                    type: string
                  startTime:
                    description: StartTime is when the backup started.
                    format: date-time
                    type: string
                type: object
              lastRetentionRun:
                description: LastRetentionRun is the timestamp of the last retention
                  run.
                format: date-time
                type: string
              lastSuccessfulBackup:
                description: LastSuccessfulBackup is the timestamp of the last successful
                  backup.
                format: date-time
                type: string
              nextBackup:
                description: NextBackup is the timestamp of the next scheduled backup.
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation of the spec
                  observed by the controller.
                format: int64
                type: integer
              snapshotsAfterRetention:
                description: SnapshotsAfterRetention is the number of snapshots after
                  retention.
                format: int32
                type: integer
              statistics:
                description: Statistics contains backup statistics.
                properties:
                  failedBackups:
                    description: FailedBackups is the number of failed backups.
                    format: int32
                    type: integer
                  lastBackupFiles:
                    description: LastBackupFiles is the number of files in the last
                      backup.
                    format: int64
                    type: integer
                  lastBackupSize:
                    description: LastBackupSize is the size of the last backup.
                    type: string
                  successfulBackups:
                    description: SuccessfulBackups is the number of successful backups.
                    format: int32
                    type: integer
                  totalBackups:
                    description: TotalBackups is the total number of backups.
                    format: int32
                    type: integer
                type: object
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
