---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: resticrestores.backup.resticbackup.io
spec:
  group: backup.resticbackup.io
  names:
    kind: ResticRestore
    listKind: ResticRestoreList
    plural: resticrestores
    shortNames:
    - rres
    singular: resticrestore
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.restoredSnapshot
      name: Snapshot
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: ResticRestore is the Schema for the resticrestores API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ResticRestoreSpec defines the desired state of ResticRestore.
            properties:
              backupRef:
                description: BackupRef references the ResticBackup CR for repository
                  info.
                properties:
                  name:
                    description: Name of the resource.
                    type: string
                  namespace:
                    description: Namespace of the resource. If empty, uses the same
                      namespace as the referencing resource.
                    type: string
                required:
                - name
                type: object
              excludePaths:
                description: ExcludePaths specifies paths to exclude from restore.
                items:
                  type: string
                type: array
              hooks:
                description: Hooks defines pre/post restore hooks.
                properties:
                  postRestore:
                    description: PostRestore runs after a successful restore.
                    properties:
                      exec:
                        description: Exec defines an exec hook to run in an existing
                          pod.
                        properties:
                          command:
                            description: Command is the command to execute.
                            items:
                              type: string
                            minItems: 1
                            type: array
                          container:
                            description: Container is the container name to execute
                              the command in.
                            type: string
                          podSelector:
                            description: PodSelector selects the pod to execute the
                              command in.
                            properties:
                              matchExpressions:
                                description: matchExpressions is a list of label selector
                                  requirements. The requirements are ANDed.
                                items:
                                  description: |-
                                    A label selector requirement is a selector that contains values, a key, and an operator that
                                    relates the key and values.
                                  properties:
                                    key:
                                      description: key is the label key that the selector
                                        applies to.
                                      type: string
                                    operator:
                                      description: |-
                                        operator represents a key's relationship to a set of values.
                                        Valid operators are In, NotIn, Exists and DoesNotExist.
                                      type: string
                                    values:
                                      description: |-
                                        values is an array of string values. If the operator is In or NotIn,
                                        the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                        the values array must be empty. This array is replaced during a strategic
                                        merge patch.
                                      items:
                                        type: string
                                      type: array
                                      x-kubernetes-list-type: atomic
                                  required:
                                  - key
                                  - operator
                                  type: object
                                type: array
                                x-kubernetes-list-type: atomic
                              matchLabels:
                                additionalProperties:
                                  type: string
                                description: |-
                                  matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                                  map is equivalent to an element of matchExpressions, whose key field is "key", the
                                  operator is "In", and the values array contains only "value". The requirements are ANDed.
                                type: object
                            type: object
                            x-kubernetes-map-type: atomic
                          timeout:
                            default: 60s
                            description: Timeout is the maximum duration for the hook
                              to run.
                            type: string
                        required:
                        - command
                        - podSelector
                        type: object
                      job:
                        description: Job defines a job-based hook.
                        properties:
                          podTemplate:
                            description: PodTemplate defines the pod specification
                              for the hook job.
                            x-kubernetes-preserve-unknown-fields: true
                        required:
                        - podTemplate
                        type: object
                    type: object
                  preRestore:
                    description: PreRestore runs before the restore starts.
                    properties:
                      exec:
                        description: Exec defines an exec hook to run in an existing
                          pod.
                        properties:
                          command:
                            description: Command is the command to execute.
                            items:
                              type: string
                            minItems: 1
                            type: array
                          container:
                            description: Container is the container name to execute
                              the command in.
                            type: string
                          podSelector:
                            description: PodSelector selects the pod to execute the
                              command in.
                            properties:
                              matchExpressions:
                                description: matchExpressions is a list of label selector
                                  requirements. The requirements are ANDed.
                                items:
                                  description: |-
                                    A label selector requirement is a selector that contains values, a key, and an operator that
                                    relates the key and values.
                                  properties:
                                    key:
                                      description: key is the label key that the selector
                                        applies to.
                                      type: string
                                    operator:
                                      description: |-
                                        operator represents a key's relationship to a set of values.
                                        Valid operators are In, NotIn, Exists and DoesNotExist.
                                      type: string
                                    values:
                                      description: |-
                                        values is an array of string values. If the operator is In or NotIn,
                                        the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                        the values array must be empty. This array is replaced during a strategic
                                        merge patch.
                                      items:
                                        type: string
                                      type: array
                                      x-kubernetes-list-type: atomic
                                  required:
                                  - key
                                  - operator
                                  type: object
                                type: array
                                x-kubernetes-list-type: atomic
                              matchLabels:
                                additionalProperties:
                                  type: string
                                description: |-
                                  matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                                  map is equivalent to an element of matchExpressions, whose key field is "key", the
                                  operator is "In", and the values array contains only "value". The requirements are ANDed.
                                type: object
                            type: object
                            x-kubernetes-map-type: atomic
                          timeout:
                            default: 60s
                            description: Timeout is the maximum duration for the hook
                              to run.
                            type: string
                        required:
                        - command
                        - podSelector
                        type: object
                      job:
                        description: Job defines a job-based hook.
                        properties:
                          podTemplate:
                            description: PodTemplate defines the pod specification
                              for the hook job.
                            x-kubernetes-preserve-unknown-fields: true
                        required:
                        - podTemplate
                        type: object
                    type: object
                type: object
              includePaths:
                description: IncludePaths specifies paths to restore. Defaults to
                  all.
                items:
                  type: string
                type: array
              jobConfig:
                description: JobConfig configures the restore job.
                properties:
                  activeDeadlineSeconds:
                    default: 3600
                    description: ActiveDeadlineSeconds specifies the job timeout.
                    format: int64
                    minimum: 1
                    type: integer
                  affinity:
                    description: Affinity defines pod affinity rules.
                    x-kubernetes-preserve-unknown-fields: true
                  backoffLimit:
                    default: 0
                    description: BackoffLimit specifies the number of retries before
                      considering a job as failed.
                    format: int32
                    minimum: 0
                    type: integer
                  concurrencyPolicy:
                    default: Forbid
                    description: ConcurrencyPolicy specifies how to treat concurrent
                      executions.
                    enum:
                    - Allow
                    - Forbid
                    - Replace
                    type: string
                  failedJobsHistoryLimit:
                    default: 3
                    description: FailedJobsHistoryLimit specifies how many failed
                      jobs to keep.
                    format: int32
                    minimum: 0
                    type: integer
                  nodeSelector:
                    additionalProperties:
                      type: string
                    description: NodeSelector defines node selection constraints.
                    type: object
                  resources:
                    description: Resources defines resource requirements for the backup
                      container.
                    x-kubernetes-preserve-unknown-fields: true
                  securityContext:
                    description: SecurityContext defines the security context for
                      the backup pod.
                    x-kubernetes-preserve-unknown-fields: true
                  serviceAccountName:
                    description: ServiceAccountName specifies the service account
                      for the backup pod.
                    type: string
                  successfulJobsHistoryLimit:
                    default: 3
                    description: SuccessfulJobsHistoryLimit specifies how many successful
                      jobs to keep.
                    format: int32
                    minimum: 0
                    type: integer
                  tolerations:
                    description: Tolerations defines pod tolerations.
                    x-kubernetes-preserve-unknown-fields: true
                type: object
              options:
                description: Options configures restore behavior.
                properties:
                  overwrite:
                    default: true
                    description: Overwrite enables overwriting existing files.
                    type: boolean
                  verify:
                    description: Verify enables verification of restored data.
                    type: boolean
                type: object
              snapshotID:
                description: SnapshotID specifies the exact snapshot to restore.
                type: string
              snapshotSelector:
                description: SnapshotSelector selects a snapshot if SnapshotID is
                  not specified.
                properties:
                  before:
                    description: Before selects the latest snapshot before this time.
                    format: date-time
                    type: string
                  hostname:
                    description: Hostname filters snapshots by hostname.
                    type: string
                  latest:
                    description: Latest selects the latest snapshot.
                    type: boolean
                  tags:
                    description: Tags filters snapshots by tags.
                    items:
                      type: string
                    type: array
                type: object
              target:
                description: Target defines where to restore data.
                properties:
                  newPVC:
                    description: NewPVC defines creating a new PVC for restore.
                    properties:
                      accessModes:
                        description: AccessModes are the access modes for the new
                          PVC.
                        items:
                          type: string
                        type: array
                      name:
                        description: Name is the name of the new PVC.
                        type: string
                      size:
                        description: Size is the size of the new PVC.
                        type: string
                      storageClassName:
                        description: StorageClassName is the storage class for the
                          new PVC.
                        type: string
                    required:
                    - name
                    - size
                    type: object
                  pvc:
                    description: PVC defines restoring to an existing PVC.
                    properties:
                      claimName:
                        description: ClaimName is the name of the PVC to restore to.
                        type: string
                      path:
                        description: Path is the path within the PVC to restore to.
                          Defaults to "/".
                        type: string
                    required:
                    - claimName
                    type: object
                type: object
            required:
            - backupRef
            - target
            type: object
          status:
            description: ResticRestoreStatus defines the observed state of ResticRestore.
            properties:
              completionTime:
                description: CompletionTime is when the restore completed.
                format: date-time
                type: string
              conditions:
                description: Conditions represent the latest available observations.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              jobRef:
                description: JobRef references the restore job.
                properties:
                  name:
                    description: Name of the resource.
                    type: string
                  namespace:
                    description: Namespace of the resource.
                    type: string
                required:
                - name
                - namespace
                type: object
              observedGeneration:
                description: ObservedGeneration reflects the generation of the spec
                  observed by the controller.
                format: int64
                type: integer
              phase:
                description: Phase is the current phase of the restore operation.
                enum:
                - Pending
                - InProgress
                - Completed
                - Failed
                type: string
              restoredFiles:
                description: RestoredFiles is the number of restored files.
                format: int64
                type: integer
              restoredSize:
                description: RestoredSize is the size of restored data.
                type: string
              restoredSnapshot:
                description: RestoredSnapshot is the ID of the restored snapshot.
                type: string
              startTime:
                description: StartTime is when the restore started.
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
